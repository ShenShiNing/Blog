---
id: "2" # è¯·ç¡®ä¿ ID å”¯ä¸€
title: "æ·±å…¥ç†è§£ React Server Components"
description: "æ¢ç´¢ React Server Components çš„å·¥ä½œåŸç†ã€ä¼˜åŠ¿ä»¥åŠå¦‚ä½•åœ¨ Next.js ä¸­ä½¿ç”¨å®ƒä»¬æ¥æ„å»ºé«˜æ€§èƒ½åº”ç”¨ã€‚"
author: "Xiaoshen" # æ›¿æ¢ä¸ºæ‚¨çš„åå­—
category: "React"
tags: ["React", "Next.js", "Server Components", "å‰ç«¯", "æ€§èƒ½ä¼˜åŒ–"]
createdDate: "2025-04-012" # æ›¿æ¢ä¸ºå®é™…å‘å¸ƒæ—¥æœŸ
---

## React Server Components (RSC) ç®€ä»‹

React Server Components (RSC) æ˜¯ React å›¢é˜Ÿå¼•å…¥çš„ä¸€é¡¹é©å‘½æ€§åŠŸèƒ½ï¼Œæ—¨åœ¨æ”¹å˜æˆ‘ä»¬æ„å»º Web åº”ç”¨çš„æ–¹å¼ã€‚ä¸ä¼ ç»Ÿçš„åªåœ¨å®¢æˆ·ç«¯è¿è¡Œçš„ React ç»„ä»¶ä¸åŒï¼ŒServer Components **å®Œå…¨åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ**ã€‚è¿™æ„å‘³ç€å®ƒä»¬çš„ä»£ç æ°¸è¿œä¸ä¼šè¢«å‘é€åˆ°ç”¨æˆ·çš„æµè§ˆå™¨ã€‚

### Server Components vs Client Components

ä¸ºäº†æ›´å¥½åœ°ç†è§£ RSCï¼Œæˆ‘ä»¬å…ˆåŒºåˆ†ä¸¤ç§ä¸»è¦çš„ç»„ä»¶ç±»å‹ï¼š

1.  **Server Components (é»˜è®¤)**:

    - åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œä¸å‚ä¸å®¢æˆ·ç«¯ JavaScript åŒ…ã€‚
    - å¯ä»¥ç›´æ¥è®¿é—®æœåŠ¡å™¨ç«¯èµ„æºï¼ˆå¦‚æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿã€å†…éƒ¨ APIï¼‰ã€‚
    - ä¸èƒ½ä½¿ç”¨ React Hooksï¼ˆå¦‚ `useState`, `useEffect`ï¼‰æˆ–æµè§ˆå™¨ APIã€‚
    - æ¸²æŸ“ç»“æœï¼ˆHTMLï¼‰ç›´æ¥æµå¼ä¼ è¾“åˆ°å®¢æˆ·ç«¯ã€‚
    - éå¸¸é€‚åˆå±•ç¤ºéäº¤äº’å¼å†…å®¹å’Œè¿›è¡Œæ•°æ®è·å–ã€‚

2.  **Client Components**:
    - åœ¨å®¢æˆ·ç«¯è¿è¡Œï¼Œéœ€è¦ä¸‹è½½å¹¶æ‰§è¡Œ JavaScriptã€‚
    - å¯ä»¥ä½¿ç”¨ React Hooks (`useState`, `useEffect` ç­‰) å’Œæµè§ˆå™¨ APIã€‚
    - å¯ä»¥å¤„ç†ç”¨æˆ·äº¤äº’ï¼ˆç‚¹å‡»ã€è¾“å…¥ç­‰ï¼‰ã€‚
    - é€šè¿‡åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ  `"use client";` æŒ‡ä»¤æ¥æ ‡è®°ã€‚

## ä¸ºä»€ä¹ˆéœ€è¦ Server Componentsï¼Ÿ

RSC çš„å‡ºç°è§£å†³äº†ä¼ ç»Ÿå®¢æˆ·ç«¯æ¸²æŸ“ (CSR) å’ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“ (SSR) çš„ä¸€äº›ç—›ç‚¹ï¼š

1.  **å‡å°å®¢æˆ·ç«¯åŒ…ä½“ç§¯**: ç”±äº RSC ä»£ç ä¸å‘é€åˆ°æµè§ˆå™¨ï¼Œåº”ç”¨çš„åˆå§‹ JavaScript è´Ÿè½½å¤§å¤§å‡å°‘ï¼ŒåŠ å¿«äº†é¡µé¢åŠ è½½é€Ÿåº¦å’Œ TTI (Time to Interactive)ã€‚
2.  **ç›´æ¥è®¿é—®åç«¯èµ„æº**: å¯ä»¥åƒåœ¨ä¼ ç»Ÿåç«¯æ¡†æ¶ä¸­ä¸€æ ·ï¼Œç›´æ¥åœ¨ç»„ä»¶å†…éƒ¨å®‰å…¨åœ°æŸ¥è¯¢æ•°æ®åº“æˆ–è°ƒç”¨å†…éƒ¨æœåŠ¡ï¼Œç®€åŒ–äº†æ•°æ®è·å–é€»è¾‘ã€‚
3.  **è‡ªåŠ¨ä»£ç åˆ†å‰²**: RSC å¤©ç„¶åœ°æŒ‰ç»„ä»¶è¿›è¡Œä»£ç åˆ†å‰²ï¼Œåªæœ‰ Client Components åŠå…¶ä¾èµ–é¡¹ä¼šè¢«å‘é€åˆ°æµè§ˆå™¨ã€‚
4.  **æ”¹è¿›çš„æ•°æ®è·å–**: é¿å…äº†å®¢æˆ·ç«¯æ•°æ®è·å–çš„ç€‘å¸ƒæµé—®é¢˜ï¼Œæ•°æ®åœ¨æœåŠ¡å™¨ä¸Šå‡†å¤‡å¥½åç›´æ¥æ¸²æŸ“ã€‚
5.  **é›¶ API å±‚**: å¯¹äºç®€å•çš„å†…éƒ¨æ•°æ®è·å–ï¼Œä¸å†éœ€è¦ä¸“é—¨åˆ›å»º API ç«¯ç‚¹ã€‚

## åœ¨ Next.js (App Router) ä¸­ä½¿ç”¨ RSC

Next.js çš„ App Router (é€šå¸¸åœ¨ `app` ç›®å½•ä¸‹) é»˜è®¤ä½¿ç”¨ React Server Componentsã€‚

**ç¤ºä¾‹ï¼šä¸€ä¸ªç®€å•çš„ Server Component**

```jsx
// app/page.tsx (è¿™æ˜¯ä¸€ä¸ª Server Component)
import db from "@/lib/db"; // å‡è®¾æœ‰ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ¨¡å—

async function getData() {
  // ç›´æ¥åœ¨æœåŠ¡å™¨ä¸ŠæŸ¥è¯¢æ•°æ®åº“
  const posts = await db.post.findMany({ take: 5 });
  return posts;
}

export default async function HomePage() {
  const latestPosts = await getData();

  return (
    <div>
      <h1>æœ€æ–°åšå®¢æ–‡ç« </h1>
      <ul>
        {latestPosts.map((post) => (
          <li key={post.id}>{post.title}</li>
        ))}
      </ul>
      {/* è¿™ä¸ªç»„ä»¶æ²¡æœ‰äº¤äº’ï¼Œæ²¡æœ‰çŠ¶æ€ï¼Œçº¯ç²¹å±•ç¤ºæ•°æ® */}
    </div>
  );
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š

- `HomePage` æ˜¯ä¸€ä¸ª Server Componentã€‚
- `getData` å‡½æ•°åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢ã€‚
- å®¢æˆ·ç«¯åªä¼šæ”¶åˆ°æ¸²æŸ“åçš„ HTMLï¼Œä¸åŒ…å«æ•°æ®åº“è®¿é—®é€»è¾‘æˆ– `db` æ¨¡å—çš„ä»£ç ã€‚

## ä½•æ—¶ä½¿ç”¨ Client Componentsï¼Ÿ

å½“ä½ éœ€è¦ä»¥ä¸‹åŠŸèƒ½æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨ Client Componentsï¼š

- **ç”¨æˆ·äº¤äº’**: å¤„ç†ç‚¹å‡»äº‹ä»¶ã€è¡¨å•æäº¤ã€è¾“å…¥ç­‰ã€‚
- **çŠ¶æ€ç®¡ç†**: ä½¿ç”¨ `useState`, `useReducer` ç­‰ Hooksã€‚
- **ç”Ÿå‘½å‘¨æœŸæ•ˆæœ**: ä½¿ç”¨ `useEffect` (ä¾‹å¦‚ï¼Œåœ¨ç»„ä»¶æŒ‚è½½åè·å–æ•°æ®æˆ–è®¾ç½®äº‹ä»¶ç›‘å¬å™¨)ã€‚
- **æµè§ˆå™¨ API**: è®¿é—® `window`, `localStorage`, `navigator` ç­‰ã€‚
- **ä¾èµ– Client Hooks çš„åº“**: å¾ˆå¤šç¬¬ä¸‰æ–¹ UI åº“æˆ–çŠ¶æ€ç®¡ç†åº“éœ€è¦å®¢æˆ·ç«¯ç¯å¢ƒã€‚

**ç¤ºä¾‹ï¼šä¸€ä¸ª Client Component**

```jsx
// components/LikeButton.tsx
"use client"; // æ ‡è®°ä¸º Client Component

import { useState, startTransition } from 'react';
import { likePostAction } from '@/actions/likeActions'; // å‡è®¾æœ‰ä¸€ä¸ª Server Action

interface LikeButtonProps {
  postId: string;
  initialLikes: number;
}

export default function LikeButton({ postId, initialLikes }: LikeButtonProps) {
  const [likes, setLikes] = useState(initialLikes);
  const [isLiked, setIsLiked] = useState(false); // å¯èƒ½éœ€è¦ä»ç”¨æˆ·æ•°æ®åˆ¤æ–­åˆå§‹çŠ¶æ€

  const handleClick = async () => {
    const newLikedState = !isLiked;
    const newLikes = newLikedState ? likes + 1 : likes - 1;

    // ä¼˜åŒ– UI æ›´æ–°
    startTransition(() => {
      setLikes(newLikes);
      setIsLiked(newLikedState);
    });

    // è°ƒç”¨ Server Action æ›´æ–°åç«¯
    await likePostAction(postId, newLikedState);
    // æ³¨æ„ï¼šServer Action å¯ä»¥åœ¨ Client Component ä¸­è°ƒç”¨
  };

  return (
    <button onClick={handleClick}>
      {isLiked ? 'â¤ï¸' : 'ğŸ¤'} {likes} Likes
    </button>
  );
}

```

**å…³é”®ç‚¹**:

- æ–‡ä»¶é¡¶éƒ¨çš„ `"use client";` æ˜¯å¿…é¡»çš„ã€‚
- å¯ä»¥ä½¿ç”¨ `useState` æ¥ç®¡ç†äº¤äº’çŠ¶æ€ã€‚
- å¯ä»¥è°ƒç”¨ Server Actions ä¸æœåŠ¡å™¨äº¤äº’ï¼Œè€Œæ— éœ€åˆ›å»ºä¼ ç»Ÿ APIã€‚

## Server Components å’Œ Client Components çš„ç»„åˆ

RSC æœ€å¼ºå¤§çš„åœ°æ–¹åœ¨äºå®ƒä»¬å¯ä»¥æ— ç¼åœ°ç»„åˆ Client Componentsã€‚

```jsx
// app/posts/[slug]/page.tsx (Server Component)
import db from '@/lib/db';
import LikeButton from '@/components/LikeButton'; // å¯¼å…¥ Client Component

async function getPostData(slug: string) {
  const post = await db.post.findUnique({
    where: { slug },
    include: { _count: { select: { likes: true } } } // è·å–ç‚¹èµæ•°
  });
  // ...é”™è¯¯å¤„ç†
  return post;
}

interface PostPageProps {
  params: { slug: string };
}

export default async function PostPage({ params }: PostPageProps) {
  const post = await getPostData(params.slug);

  if (!post) {
    // å¤„ç†å¸–å­æœªæ‰¾åˆ°çš„æƒ…å†µ
    return <div>å¸–å­æœªæ‰¾åˆ°</div>;
  }

  return (
    <article>
      <h1>{post.title}</h1>
      <div dangerouslySetInnerHTML={{ __html: post.contentHtml }} />
      <hr />
      {/* åœ¨ Server Component ä¸­æ¸²æŸ“ Client Component */}
      <LikeButton postId={post.id} initialLikes={post._count.likes} />
    </article>
  );
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š

- `PostPage` (Server Component) è´Ÿè´£è·å–å¸–å­æ•°æ®å¹¶åœ¨æœåŠ¡å™¨ä¸Šæ¸²æŸ“ä¸»è¦å†…å®¹ã€‚
- `LikeButton` (Client Component) è¢«åµŒå…¥åˆ°é¡µé¢ä¸­ï¼Œè´Ÿè´£å¤„ç†ç‚¹èµçš„äº¤äº’é€»è¾‘ã€‚
- Server Component å¯ä»¥å°† props (å¦‚ `postId`, `initialLikes`) ä¼ é€’ç»™ Client Componentã€‚

**é‡è¦é™åˆ¶**: ä½ ä¸èƒ½åœ¨ Client Component ä¸­ç›´æ¥ `import` Server Componentã€‚ä½†å¯ä»¥é€šè¿‡ props (å¦‚ `children`) å°† Server Component ä½œä¸ºå­å…ƒç´ ä¼ é€’ç»™ Client Componentã€‚

## æ€»ç»“ä¸æœ€ä½³å®è·µ

React Server Components æä¾›äº†ä¸€ç§å¼ºå¤§çš„æ–°èŒƒå¼æ¥æ„å»º Web åº”ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨ Next.js App Router ä¸­ã€‚

- **é»˜è®¤ä½¿ç”¨ Server Components**: å°½å¯èƒ½ä¿æŒç»„ä»¶åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚
- **ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨ Client Components**: å½“éœ€è¦äº¤äº’ã€çŠ¶æ€ã€ç”Ÿå‘½å‘¨æœŸæˆ–æµè§ˆå™¨ API æ—¶ï¼Œæ‰åˆ‡æ¢åˆ° Client Componentsã€‚
- **å°† Client Components å°½å¯èƒ½æ¨å‘å¶å­èŠ‚ç‚¹**: ä¿æŒå¤§éƒ¨åˆ†é¡µé¢ç»“æ„æ˜¯ Server Componentsï¼Œåªå°†äº¤äº’éƒ¨åˆ†å°è£…æˆå°çš„ Client Componentsã€‚
- **åˆ©ç”¨ Server Actions**: åœ¨ Client Components ä¸­ä¸æœåŠ¡å™¨äº¤äº’æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ Server Actionsï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨åˆ›å»º API ç«¯ç‚¹ã€‚

æŒæ¡ RSC å’Œ Client Components çš„åŒºåˆ«ä¸ç»„åˆï¼Œæ˜¯æ„å»ºç°ä»£ã€é«˜æ€§èƒ½ React åº”ç”¨çš„å…³é”®ã€‚

## å‚è€ƒèµ„æº

- [React Server Components å®˜æ–¹ä»‹ç»](https://react.dev/reference/react/use-server)
- [Next.js App Router æ–‡æ¡£](https://nextjs.org/docs/app)
